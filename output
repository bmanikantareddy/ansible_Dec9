[opc@ansible-host ansible-ol7_fluentbit]$ ansible-playbook -i inventory fluentBit.yml

PLAY [all] *********************************************************************************************************************************************************************************************************************************************************************

TASK [Gathering Facts] *********************************************************************************************************************************************************************************************************************************************************
[WARNING]: Platform linux on host 132.145.134.155 is using the discovered Python interpreter at /usr/bin/python, but future installation of another Python interpreter could change this. See
https://docs.ansible.com/ansible/2.9/reference_appendices/interpreter_discovery.html for more information.
ok: [132.145.134.155]
[WARNING]: Platform linux on host 150.136.212.208 is using the discovered Python interpreter at /usr/bin/python, but future installation of another Python interpreter could change this. See
https://docs.ansible.com/ansible/2.9/reference_appendices/interpreter_discovery.html for more information.
ok: [150.136.212.208]

TASK [include_role : ansible-role-fluentbit] ***********************************************************************************************************************************************************************************************************************************

TASK [ansible-role-fluentbit : Install Fluentbit] ******************************************************************************************************************************************************************************************************************************
included: /home/opc/ansible/ansible-ol7_fluentbit/ansible-role-fluentbit/tasks/add-pkg-repo.yml for 132.145.134.155, 150.136.212.208

TASK [ansible-role-fluentbit : Write VM metadata to var log vm info] ***********************************************************************************************************************************************************************************************************
changed: [132.145.134.155]
changed: [150.136.212.208]

TASK [ansible-role-fluentbit : Install Redhat | Add yum repository] ************************************************************************************************************************************************************************************************************
ok: [132.145.134.155]
ok: [150.136.212.208]

TASK [ansible-role-fluentbit : Add Server repository] **************************************************************************************************************************************************************************************************************************
ok: [132.145.134.155]
ok: [150.136.212.208]

TASK [ansible-role-fluentbit : Install td-agent-bit(fluent-bit)] ***************************************************************************************************************************************************************************************************************
changed: [150.136.212.208]
changed: [132.145.134.155]

TASK [ansible-role-fluentbit : Download td-agent-bit rpm] **********************************************************************************************************************************************************************************************************************
skipping: [132.145.134.155]
skipping: [150.136.212.208]

TASK [ansible-role-fluentbit : Ensure latest version of td-agent-bit.rpm packages is installed.] *******************************************************************************************************************************************************************************
skipping: [132.145.134.155]
skipping: [150.136.212.208]

TASK [ansible-role-fluentbit : Download osquery rpm] ***************************************************************************************************************************************************************************************************************************
ok: [132.145.134.155]
ok: [150.136.212.208]

TASK [ansible-role-fluentbit : Ensure latest version of osquery packages is installed.] ****************************************************************************************************************************************************************************************
ok: [132.145.134.155]
ok: [150.136.212.208]

TASK [ansible-role-fluentbit : Ansible check directory.] ***********************************************************************************************************************************************************************************************************************
ok: [132.145.134.155]
ok: [150.136.212.208]

TASK [ansible-role-fluentbit : Creates /etc/osquery directory] *****************************************************************************************************************************************************************************************************************
changed: [132.145.134.155]
changed: [150.136.212.208]

TASK [ansible-role-fluentbit : Ensure td-agent-bit((fluent-bit)) Service is enabled and started] *******************************************************************************************************************************************************************************
ok: [132.145.134.155]
ok: [150.136.212.208]

TASK [ansible-role-fluentbit : Ensure td-agent-bit((fluent-bit)) Service is enabled and started] *******************************************************************************************************************************************************************************
skipping: [132.145.134.155]
skipping: [150.136.212.208]

TASK [ansible-role-fluentbit : Ensure osquery Service is enabled and started Osquery] ******************************************************************************************************************************************************************************************
ok: [132.145.134.155]
ok: [150.136.212.208]

TASK [ansible-role-fluentbit : Configure | Source td-agent-bit main conf] ******************************************************************************************************************************************************************************************************
changed: [132.145.134.155]
changed: [150.136.212.208]

TASK [ansible-role-fluentbit : Configure | Source osquery main conf] ***********************************************************************************************************************************************************************************************************
changed: [132.145.134.155]
changed: [150.136.212.208]

TASK [ansible-role-fluentbit : check for vminfo exists] ************************************************************************************************************************************************************************************************************************
ok: [132.145.134.155]
ok: [150.136.212.208]

TASK [ansible-role-fluentbit : Download JSON content play] *********************************************************************************************************************************************************************************************************************
ok: [132.145.134.155]
ok: [150.136.212.208]

TASK [ansible-role-fluentbit : save the Json data to vminfo as a Fact] *********************************************************************************************************************************************************************************************************
ok: [132.145.134.155]
ok: [150.136.212.208]

TASK [ansible-role-fluentbit : copying vminfo to file] *************************************************************************************************************************************************************************************************************************
changed: [132.145.134.155]
changed: [150.136.212.208]

TASK [ansible-role-fluentbit : Download JSON content play] *********************************************************************************************************************************************************************************************************************
ok: [132.145.134.155]
ok: [150.136.212.208]

TASK [ansible-role-fluentbit : save the Json data to vcninfo as a Fact] ********************************************************************************************************************************************************************************************************
ok: [132.145.134.155]
ok: [150.136.212.208]

TASK [ansible-role-fluentbit : Retrieve the fileds from json data] *************************************************************************************************************************************************************************************************************
ok: [132.145.134.155]
ok: [150.136.212.208]

TASK [ansible-role-fluentbit : Print out Vminfo] *******************************************************************************************************************************************************************************************************************************
ok: [132.145.134.155] => {
    "msg": [
        "availabilityDomain: SWli:US-ASHBURN-AD-1",
        "compartmentId: ocid1.tenancy.oc1..aaaaaaaajptvfopb7zbkdrdi64efc2osyrq6ntuoslr43rq6yl7j5pssxpbq",
        "faultDomain: FAULT-DOMAIN-1",
        "host_ip: 10.0.0.46",
        "hostname: oracle-linux-7",
        "instanceId: ocid1.instance.oc1.iad.anuwcljrzvensjychlvdz6lomygjq2dypazravvhfophteglckd2nre6ld4a",
        "oci_region: us-ashburn-1",
        "subnet_cidr: 10.0.0.0/24",
        "vm_shape: VM.Standard.E4.Flex",
        "vnic_id: ocid1.vnic.oc1.iad.abuwcljragx2gxseomn7a55oogqign3eivoec2og5pt6gemkg63xxtrw7kqq",
        "image_id: ocid1.image.oc1.iad.aaaaaaaaxnniiwolr6k5smo4gybuys37zraeodjip6rxjghtzg76ajryeioq"
    ]
}
ok: [150.136.212.208] => {
    "msg": [
        "availabilityDomain: SWli:US-ASHBURN-AD-1",
        "compartmentId: ocid1.tenancy.oc1..aaaaaaaajptvfopb7zbkdrdi64efc2osyrq6ntuoslr43rq6yl7j5pssxpbq",
        "faultDomain: FAULT-DOMAIN-1",
        "host_ip: 10.0.0.161",
        "hostname: oraclelinux8",
        "instanceId: ocid1.instance.oc1.iad.anuwcljrzvensjyc7e6fpj2vnlqnwummw7ys3qpfwh3yf26bkttlfsptw7hq",
        "oci_region: us-ashburn-1",
        "subnet_cidr: 10.0.0.0/24",
        "vm_shape: VM.Standard.E4.Flex",
        "vnic_id: ocid1.vnic.oc1.iad.abuwcljr4xz2ytbkittqevq5gvdo7tifobahzogwzycfcsfmghfkohds6dya",
        "image_id: ocid1.image.oc1.iad.aaaaaaaak6w63p4ddsxlh2hgqh2vycoivsdevwy2utwsqjxwcvsj4vfstlqa"
    ]
}

TASK [ansible-role-fluentbit : adding meta data to /etc/fluent-bit/fluent-bit.conf] ********************************************************************************************************************************************************************************************
changed: [132.145.134.155] => (item={u'replace_str': u'availabilityDomain SWli:US-ASHBURN-AD-1', u'match_str': u'availabilityDomain'})
changed: [150.136.212.208] => (item={u'replace_str': u'availabilityDomain SWli:US-ASHBURN-AD-1', u'match_str': u'availabilityDomain'})
changed: [132.145.134.155] => (item={u'replace_str': u'compartmentId ocid1.tenancy.oc1..aaaaaaaajptvfopb7zbkdrdi64efc2osyrq6ntuoslr43rq6yl7j5pssxpbq', u'match_str': u'compartmentId'})
changed: [150.136.212.208] => (item={u'replace_str': u'compartmentId ocid1.tenancy.oc1..aaaaaaaajptvfopb7zbkdrdi64efc2osyrq6ntuoslr43rq6yl7j5pssxpbq', u'match_str': u'compartmentId'})
changed: [132.145.134.155] => (item={u'replace_str': u'instanceId ocid1.instance.oc1.iad.anuwcljrzvensjychlvdz6lomygjq2dypazravvhfophteglckd2nre6ld4a', u'match_str': u'instanceId'})
changed: [150.136.212.208] => (item={u'replace_str': u'instanceId ocid1.instance.oc1.iad.anuwcljrzvensjyc7e6fpj2vnlqnwummw7ys3qpfwh3yf26bkttlfsptw7hq', u'match_str': u'instanceId'})
changed: [132.145.134.155] => (item={u'replace_str': u'vm_shape VM.Standard.E4.Flex', u'match_str': u'vm_shape'})
changed: [132.145.134.155] => (item={u'replace_str': u'host_ip 10.0.0.46', u'match_str': u'host_ip'})
changed: [150.136.212.208] => (item={u'replace_str': u'vm_shape VM.Standard.E4.Flex', u'match_str': u'vm_shape'})
changed: [132.145.134.155] => (item={u'replace_str': u'oci_region us-ashburn-1', u'match_str': u'oci_region'})
changed: [150.136.212.208] => (item={u'replace_str': u'host_ip 10.0.0.161', u'match_str': u'host_ip'})
changed: [132.145.134.155] => (item={u'replace_str': u'faultDomain FAULT-DOMAIN-1', u'match_str': u'faultDomain'})
changed: [150.136.212.208] => (item={u'replace_str': u'oci_region us-ashburn-1', u'match_str': u'oci_region'})
changed: [132.145.134.155] => (item={u'replace_str': u'imageId ocid1.image.oc1.iad.aaaaaaaaxnniiwolr6k5smo4gybuys37zraeodjip6rxjghtzg76ajryeioq', u'match_str': u'imageId'})
changed: [150.136.212.208] => (item={u'replace_str': u'faultDomain FAULT-DOMAIN-1', u'match_str': u'faultDomain'})
changed: [132.145.134.155] => (item={u'replace_str': u'vnic_id ocid1.vnic.oc1.iad.abuwcljragx2gxseomn7a55oogqign3eivoec2og5pt6gemkg63xxtrw7kqq', u'match_str': u'vnic_id'})
changed: [132.145.134.155] => (item={u'replace_str': u'subnet_cidr 10.0.0.0/24', u'match_str': u'subnet_cidr'})
changed: [150.136.212.208] => (item={u'replace_str': u'imageId ocid1.image.oc1.iad.aaaaaaaak6w63p4ddsxlh2hgqh2vycoivsdevwy2utwsqjxwcvsj4vfstlqa', u'match_str': u'imageId'})
changed: [132.145.134.155] => (item={u'replace_str': u'hostname oracle-linux-7', u'match_str': u'hostname'})
changed: [150.136.212.208] => (item={u'replace_str': u'vnic_id ocid1.vnic.oc1.iad.abuwcljr4xz2ytbkittqevq5gvdo7tifobahzogwzycfcsfmghfkohds6dya', u'match_str': u'vnic_id'})
changed: [150.136.212.208] => (item={u'replace_str': u'subnet_cidr 10.0.0.0/24', u'match_str': u'subnet_cidr'})
changed: [150.136.212.208] => (item={u'replace_str': u'hostname oraclelinux8', u'match_str': u'hostname'})

TASK [ansible-role-fluentbit : Check whether /etc/rsyslog.conf:6,7 contains "10.5.236.52:514"] *********************************************************************************************************************************************************************************
skipping: [150.136.212.208]
ok: [132.145.134.155]

TASK [ansible-role-fluentbit : replace remote host in /etc/rsyslog.conf:6,7] ***************************************************************************************************************************************************************************************************
skipping: [132.145.134.155]
skipping: [150.136.212.208]

TASK [ansible-role-fluentbit : Writing to forwarded-logs.log] ******************************************************************************************************************************************************************************************************************
skipping: [132.145.134.155]
skipping: [150.136.212.208]

TASK [ansible-role-fluentbit : Check whether /etc/rsyslog.conf:8 contains "10.5.236.52:514"] ***********************************************************************************************************************************************************************************
skipping: [132.145.134.155]
ok: [150.136.212.208]

TASK [ansible-role-fluentbit : replace remote host in /etc/rsyslog.conf:8] *****************************************************************************************************************************************************************************************************
skipping: [132.145.134.155]
skipping: [150.136.212.208]

TASK [ansible-role-fluentbit : Writing to forwarded-logs.log] ******************************************************************************************************************************************************************************************************************
skipping: [132.145.134.155]
skipping: [150.136.212.208]

RUNNING HANDLER [ansible-role-fluentbit : Restart Fluentbit] *******************************************************************************************************************************************************************************************************************
changed: [150.136.212.208]
changed: [132.145.134.155]

RUNNING HANDLER [ansible-role-fluentbit : Restart Osquery] *********************************************************************************************************************************************************************************************************************
changed: [132.145.134.155]
changed: [150.136.212.208]

PLAY RECAP *********************************************************************************************************************************************************************************************************************************************************************
132.145.134.155            : ok=26   changed=9    unreachable=0    failed=0    skipped=8    rescued=0    ignored=0
150.136.212.208            : ok=26   changed=9    unreachable=0    failed=0    skipped=8    rescued=0    ignored=0
